(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{81:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return i})),r.d(t,"metadata",(function(){return c})),r.d(t,"toc",(function(){return s})),r.d(t,"default",(function(){return d}));var n=r(3),a=r(7),o=(r(0),r(99)),i={id:"async",title:"Async producers & createDraft / finishDraft",sidebar_label:"Async produce / createDraft"},c={unversionedId:"async",id:"async",isDocsHomePage:!1,title:"Async producers & createDraft / finishDraft",description:"<div",source:"@site/docs/async.mdx",slug:"/async",permalink:"/immer/async",editUrl:"https://github.com/immerjs/immer/edit/master/website/docs/async.mdx",version:"current",sidebar_label:"Async produce / createDraft",sidebar:"Immer",previous:{title:"Returning new data from producers",permalink:"/immer/return"},next:{title:"Using TypeScript or Flow",permalink:"/immer/typescript"}},s=[{value:"<code>createDraft</code> and <code>finishDraft</code>",id:"createdraft-and-finishdraft",children:[]}],l={toc:s};function d(e){var t=e.components,r=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},l,r,{components:t,mdxType:"MDXLayout"}),Object(o.b)("center",null,Object(o.b)("div",{"data-ea-publisher":"immerjs","data-ea-type":"image",className:"horizontal bordered"}))," ",Object(o.b)("details",null,Object(o.b)("summary",{className:"egghead-summary"},"egghead.io lesson 11: Creating ",Object(o.b)("b",null,"async")," producers (and why you shouldn\u2019t)"),Object(o.b)("br",null),Object(o.b)("div",null,Object(o.b)("iframe",{width:"760",height:"427",scrolling:"no",src:"https://egghead.io/lessons/react-write-asynchronous-producers-in-immer-and-why-you-shouldn-t/embed"})),Object(o.b)("a",{className:"egghead-link",href:"https://egghead.io/lessons/react-write-asynchronous-producers-in-immer-and-why-you-shouldn-t"},"Hosted on egghead.io")),Object(o.b)("p",null,"It is allowed to return Promise objects from recipes. Or, in other words, to use ",Object(o.b)("inlineCode",{parentName:"p"},"async / await"),". This can be pretty useful for long running processes, that only produce the new object once the promise chain resolves. Note that ",Object(o.b)("inlineCode",{parentName:"p"},"produce")," itself (even in the curried form) will return a promise if the producer is async. Example:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-javascript"},'import produce from "immer"\n\nconst user = {\n    name: "michel",\n    todos: []\n}\n\nconst loadedUser = await produce(user, async function(draft) {\n    draft.todos = await (await window.fetch("http://host/" + draft.name)).json()\n})\n')),Object(o.b)("p",null,Object(o.b)("em",{parentName:"p"},"Warning: please note that the draft shouldn't be 'leaked' from the async process and stored else where. The draft will still be revoked as soon as the async process completes.")),Object(o.b)("h2",{id:"createdraft-and-finishdraft"},Object(o.b)("inlineCode",{parentName:"h2"},"createDraft")," and ",Object(o.b)("inlineCode",{parentName:"h2"},"finishDraft")),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"createDraft")," and ",Object(o.b)("inlineCode",{parentName:"p"},"finishDraft")," are two low-level functions that are mostly useful for libraries that build abstractions on top of immer. It avoids the need to always create a function in order to work with drafts. Instead, one can create a draft, modify it, and at some time in the future finish the draft, in which case the next immutable state will be produced. We could for example rewrite our above example as:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-javascript"},'import {createDraft, finishDraft} from "immer"\n\nconst user = {\n    name: "michel",\n    todos: []\n}\n\nconst draft = createDraft(user)\ndraft.todos = await (await window.fetch("http://host/" + draft.name)).json()\nconst loadedUser = finishDraft(draft)\n')),Object(o.b)("p",null,"Note: ",Object(o.b)("inlineCode",{parentName:"p"},"finishDraft")," takes a ",Object(o.b)("inlineCode",{parentName:"p"},"patchListener")," as second argument, which can be used to record the patches, similarly to ",Object(o.b)("inlineCode",{parentName:"p"},"produce"),"."),Object(o.b)("p",null,Object(o.b)("em",{parentName:"p"},"Warning: in general, we recommend to use ",Object(o.b)("inlineCode",{parentName:"em"},"produce")," instead of the ",Object(o.b)("inlineCode",{parentName:"em"},"createDraft")," / ",Object(o.b)("inlineCode",{parentName:"em"},"finishDraft")," combo, ",Object(o.b)("inlineCode",{parentName:"em"},"produce")," is less error prone in usage, and more clearly separates the concepts of mutability and immutability in your code base.")))}d.isMDXComponent=!0},99:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return b}));var n=r(0),a=r.n(n);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=a.a.createContext({}),d=function(e){var t=a.a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):c(c({},t),e)),r},p=function(e){var t=d(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},m=a.a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=d(r),m=n,b=p["".concat(i,".").concat(m)]||p[m]||u[m]||o;return r?a.a.createElement(b,c(c({ref:t},l),{},{components:r})):a.a.createElement(b,c({ref:t},l))}));function b(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,i=new Array(o);i[0]=m;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:n,i[1]=c;for(var l=2;l<o;l++)i[l]=r[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,r)}m.displayName="MDXCreateElement"}}]);